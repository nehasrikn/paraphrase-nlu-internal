<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>

<link href = "https://code.jquery.com/ui/1.12.1/themes/ui-lightness/jquery-ui.css" rel="stylesheet">

<style>
	body {
		padding: 10px;
		margin-bottom: 10px;
		font: Roboto;
	}
	.first-container{
	    display: flex;
	    justify-content: space-around;
	   	width: 1300px;
	   	padding: 10px;
	   	border: 1px solid black;
	   	background-color: #e1f0f0;
	}
	.left-container {
			float: left;
			width: 25%;
			text-align: center;
			overflow: scroll;
			padding: 5px;
	}
	.middle-container {
			float: left;
			width: 50%;
			overflow: scroll;
			text-align: center;
			padding-left: 10px;
			padding-right: 20px;
	}
	.right-container {
			float: left;
			width: 25%;
			padding-left: 10px;
			text-align: center;
			overflow: scroll;
			padding: 5px;
	}
	.card {
		margin: 10px;
		width: 250px;
		overflow-wrap: break-word;
	}

	.crowd-card {
    width: 100%;
  }

	.collapsible {
	  background-color:  #ccc;
	  color: #444;
	  cursor: pointer;
	  padding: 5px;
	  width: 50%;
	  border: none;
	  text-align: left;
	  outline: none;
	  font-size: 20px;
	  height:30px;
	  border-radius: 12px;
	}

	/* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
	.active, .collapsible:hover {
	  background-color: #ccc;
	}

	/* Style the collapsible content. Note: hidden by default */
	.content {
	  padding: 0 18px;
	  background-color: #f1f1f1;
	  max-height: 0px;
	  overflow: hidden;
	  transition: max-height 0.2s ease-out;
	  width: 75%;
	}
	.collapsible:after {
	  content: '\02795'; /* Unicode character for "plus" sign (+) */
	  font-size: 13px;
	  color: white;
	  float: right;
	  margin-left: 5px;
	}

	.active:after {
	  content: "\2796"; /* Unicode character for "minus" sign (-) */
	}

</style>

<crowd-form onsubmit="verifyHIT();">
	<div>
		<button id="coll_button" type="button" class="collapsible active" onload="clickCollapsible()"><b><u>Task Instructions</u></b></button>
		<div class="content" style="max-height: 1200px !important; height: auto;">
			<br>
			<b><u>Instructions:</b></u><br>
			Are machines sensitive to paraphrasing? Ideally, when machines are presented with two snippets of text that convey the same meaning yet utilize different words, they should behave in a similar way. In this HIT, we’ll present a simple story, and your task will be to paraphrase the middle portion of it (i.e use different words to convey the same meaning).
			<br><br>
		</div>
	<br>
	<!-- ALL DATA -->
	<div id=task1 class='first-container'>
			<div class="left-container">
				<h3>Beginning</h3>
			    <crowd-card>
			      <div class="card">
			        George decided to buy a TV.
			      </div>
			    </crowd-card>
			</div>

			<div class="middle-container">
				<h3>Middle</h3>

				<crowd-tabs>
					<crowd-tab header="Sentence 1 (Plausible Middle)">

						<crowd-card>
				      <div class="card">
				        He took it home, unpacked it, and placed it where he wanted it.
				      </div>
				    </crowd-card>

						<div style='text-align: left; width: 600px; padding-left: 5px; padding-top: 30px'>
							<b> Paraphrase the sentence above in two different ways</b> such that its meaning is retained, but the words themselves substantially differ from those in the original sentence.

							<crowd-input id='paraphrase_entry_1' name='paraphrase' label="Paraphrased Hypothesis #1" required onchange 
							           onpropertychange 
							           onkeyuponpaste oninput="calculate_BLEU()"></crowd-input>
							<div id='bleu'>Similarity: </div>

							<crowd-input id='paraphrase_entry_2' name='paraphrase' label="Paraphrased Hypothesis #2" required onchange 
							           onpropertychange 
							           onkeyuponpaste oninput="calculate_BLEU()"></crowd-input>
							<div id='bleu_1'>Similarity: </div>
						</div>

					</crowd-tab>

					<crowd-tab header='Sentence 2 (Implausible Middle)'>
												<crowd-card>
				      <div class="card">
				        The TV had a cracked screen.
				      </div>
				    </crowd-card>

						<div style='text-align: left; width: 600px; padding-left: 5px; padding-top: 30px'>
							<b> Paraphrase the sentence above in two different ways</b> such that its meaning is retained, but the words themselves substantially differ from those in the original sentence.

							<crowd-input id='paraphrase_entry_3' name='paraphrase' label="Paraphrased Hypothesis #1" required onchange 
							           onpropertychange 
							           onkeyuponpaste oninput="calculate_BLEU()"></crowd-input>
							<div id='bleu'>Similarity: </div>

							<crowd-input id='paraphrase_entry_4' name='paraphrase' label="Paraphrased Hypothesis #2" required onchange 
							           onpropertychange 
							           onkeyuponpaste oninput="calculate_BLEU()"></crowd-input>
							<div id='bleu_1'>Similarity: </div>
						</div>

					</crowd-tab>


					</crowd-tab>
				</crowd-tabs>
			    

			</div>

			<!-- <span id="vertical-separator"></span> -->
			<div class="right-container">
				<h3>Ending</h3>
				<crowd-card>
			      <div class="card">
			        Things had turned out just as he’d hoped.
			      </div>
			    </crowd-card>
			</div>
	</div>

  	<br>
  	<div style="padding-left: 20px; position: relative;">
  		<crowd-button id="submit_button" form-action="submit">
  			Submit
  		</crowd-button>
  		<div id="errorBox"></div>
  		<br>
  	</div>
	
	<script>

		//AUTOCOMPLETE_FUNCTIONS

		var coll = document.getElementsByClassName("collapsible");
		var i;

		for (i = 0; i < coll.length; i++) {
		  coll[i].addEventListener("click", function() {
		    this.classList.toggle("active");
		    var content = this.nextElementSibling;
		    if (content.style.maxHeight){
		      content.style.maxHeight = null;
		    } else {
		      content.style.maxHeight = content.scrollHeight + "px";
		    }
		  });
		}

		function verifyTaskCompleted(){
			var freeText = document.getElementById('paraphrase_entry');
			if(freeText.value.trim() === ""){
					errorBox.innerHTML = '<crowd-alert type="error" dismissible>You must enter a paraphrase!</crowd-alert>';
					return false
			}
  		return true;
		}

		function verifyHIT(){
	      if (!verifyTaskCompleted()) {
	          alert("Oh no! You didn't fill out a field. Check the error below the submit button.");
	          event.preventDefault(); 
	      }
    }

    function calculate_BLEU() {
    	var freeText = document.getElementById('paraphrase_entry');
    	document.getElementById("bleu").innerText = freeText.value;

    	const para_tokens = freeText.value.split(' ')
    	const hyp_tokens = 'He took it home, unpacked it, and placed it where he wanted it.'.split(' ')

    	var para_tokens_set = new Set(para_tokens)
    	var hyp_tokens_set = new Set(hyp_tokens)

    	intersection = new Set(para_tokens.filter(x=>hyp_tokens_set.has(x)) ),
		  union = new Set(para_tokens.concat(hyp_tokens));  // This step is unnecessary but is for semantic illustration
		  const jaccard_sim = intersection.size / union.size
		  
		  document.getElementById("bleu").innerText = 'Similarity: ' + jaccard_sim.toPrecision(2);

    }

	</script>
</crowd-form>